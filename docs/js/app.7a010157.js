(function(t){function e(e){for(var r,o,s=e[0],l=e[1],u=e[2],c=0,f=[];c<s.length;c++)o=s[c],a[o]&&f.push(a[o][0]),a[o]=0;for(r in l)Object.prototype.hasOwnProperty.call(l,r)&&(t[r]=l[r]);d&&d(e);while(f.length)f.shift()();return i.push.apply(i,u||[]),n()}function n(){for(var t,e=0;e<i.length;e++){for(var n=i[e],r=!0,s=1;s<n.length;s++){var l=n[s];0!==a[l]&&(r=!1)}r&&(i.splice(e--,1),t=o(o.s=n[0]))}return t}var r={},a={app:0},i=[];function o(e){if(r[e])return r[e].exports;var n=r[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=t,o.c=r,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)o.d(n,r,function(e){return t[e]}.bind(null,r));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],l=s.push.bind(s);s.push=e,s=s.slice();for(var u=0;u<s.length;u++)e(s[u]);var d=l;i.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"034f":function(t,e,n){"use strict";var r=n("64a9"),a=n.n(r);a.a},"0f52":function(t,e,n){"use strict";var r=n("4f9b"),a=n.n(r);a.a},1:function(t,e){},2:function(t,e){},"4f9b":function(t,e,n){},"56d7":function(t,e,n){"use strict";n.r(e);n("cadf"),n("551c"),n("097d");var r=n("2b0e"),a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("Transfer")],1)},i=[],o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("el-row",{staticStyle:{"margin-left":"0","margin-right":"0"},attrs:{gutter:20}},[n("el-col",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{span:12,offset:6,"element-loading-text":t.finishedNumber+"/"+t.total,"element-loading-spinner":"el-icon-loading"}},[n("div",{staticStyle:{"text-align":"left"}},[n("p",{staticStyle:{"font-size":"28px"}},[t._v("说明\n                ")]),n("p"),n("p",[t._v("1. 用于现有Disqus评论转移至Valine(LeanCloud)。")]),n("p",[t._v("2. 回复楼层、时间显示正常；由于Disqus导出内容限制，邮箱、头像、网站链接丢失。")]),n("p",[t._v("3. 需要临时将 "),n("span",{staticStyle:{"font-weight":"bold",color:"#e11212cc"}},[t._v("https://taosky.github.io")]),t._v(" 添加到"),n("span",[t._v("LeanCloud安全域名")]),t._v("。")]),n("p",[t._v("4. 数据会多出一个DisqusToValineTest，是检查ID和KEY用的，可以删除。")]),n("p",[t._v("5. 纯前端操作，项目代码：https://github.com/taosky/disqus-to-valine")])]),n("div",{staticStyle:{"margin-bottom":"20px"}},[n("el-input",{attrs:{placeholder:"LeanCloud APP ID"},model:{value:t.leanId,callback:function(e){t.leanId=e},expression:"leanId"}}),n("el-input",{attrs:{placeholder:"LeanCloud APP KEY"},model:{value:t.leanKey,callback:function(e){t.leanKey=e},expression:"leanKey"}}),n("el-input",{attrs:{placeholder:"LeanCloud REST API 服务器地址"},model:{value:t.leanApi,callback:function(e){t.leanApi=e},expression:"leanApi"}}),n("el-input",{attrs:{type:"textarea",rows:20,placeholder:"Disqus导出的XML内容"},model:{value:t.disqusXml,callback:function(e){t.disqusXml=e},expression:"disqusXml"}})],1),n("div",[n("el-button",{attrs:{type:"warning"},on:{click:t.startTrans}},[t._v("开始转换")])],1)])],1)],1)},s=[],l=(n("7f7f"),n("ac4d"),n("8a81"),n("55dd"),n("ac6a"),n("aef6"),n("f559"),n("a481"),n("bc3a")),u=n.n(l);window.convert=n("c51a");var d={name:"transfer",data:function(){return{leanId:"",leanKey:"",leanApi:"",disqusXml:"",threads:{},comments:{},sortedComments:[],finishedNumber:0,total:0,loading:!1}},methods:{sendNotify:function(t){this.$notify({title:"提示",message:t,type:"success",duration:0})},sendError:function(t){this.$notify.error({title:"错误",message:t,duration:5e3})},xml2js:function(){var t={};try{t=window.convert.xml2js(this.disqusXml,{compact:!0})}catch(e){return this.sendError("XML格式错误"),null}return t.hasOwnProperty("disqus")&&"http://disqus.com"===t["disqus"]["_attributes"]["xmlns"]?t:(this.sendError("XML格式错误"),null)},reUrl:function(t){if(!t)return t;var e=t;return e.indexOf("index.html")&&(e=e.replace("index.html","").replace("//","/")),e.startsWith("/")||(e="/"+e),e.endsWith("/")||(e+="/"),e},sendLean:function(t,e,n){var r="".concat(this.leanApi,"/1.1/classes/Comment"),a={"X-LC-Id":n.leanId,"X-LC-Key":n.leanKey,"Content-Type":"application/json"};if(t.hasOwnProperty("parent")){var i=t["parent"]["_attributes"]["dsq:id"],o=n.comments[i]["objectId"];e["pid"]=o,e["rid"]=o}return new Promise(function(t,n){u.a.post(r,e,{headers:a}).then(function(e){e.data?t(e.data):n(e)}).catch(function(t){n(t)})})},startTrans:function(){var t=this,e=this.xml2js();if(null!==e){t.total=e.disqus["post"].length,t.loading=!0,e.disqus["thread"].forEach(function(e){e.id.hasOwnProperty("_text")&&(t.threads[e._attributes["dsq:id"]]=t.reUrl(e.id._text))});var n=!0,r=!1,a=void 0;try{for(var i,o=e.disqus["post"][Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var s=i.value,l=1;"false"===s["isDeleted"]["_text"]&&"false"===s["isSpam"]["_text"]||(l=0),t.comments[s._attributes["dsq:id"]]={status:l,nick:s["author"]["name"]["_text"],url:t.threads[s["thread"]["_attributes"]["dsq:id"]],comment:s["message"]["_cdata"],insertedAt:{__type:"Date",iso:s["createdAt"]["_text"].replace("Z",".249Z")}}}}catch(m){r=!0,a=m}finally{try{n||null==o.return||o.return()}finally{if(r)throw a}}var d=[],c=e.disqus["post"].sort(function(t,e){return t._attributes["dsq:id"]-e._attributes["dsq:id"]});c.forEach(function(e){var n=t.comments[e._attributes["dsq:id"]];d.push({post:e,comment:n})});var f="".concat(this.leanApi,"/1.1/classes/DisqusToValineTest"),p={"X-LC-Id":t.leanId,"X-LC-Key":t.leanKey,"Content-Type":"application/json"};u.a.post(f,{title:"disqus-to-valine"},{headers:p}).then(function(){d.reduce(function(e,n){return e.then(function(){return t.sendLean(n["post"],n["comment"],t).then(function(e){t.comments[n["post"]._attributes["dsq:id"]]["objectId"]=e.objectId,t.finishedNumber=t.finishedNumber+1,t.total===t.finishedNumber&&(t.loading=!1,t.sendNotify("转移完毕，共".concat(t.total,"条。")))})})},Promise.resolve())}).catch(function(){t.loading=!1,t.sendError("请检查LeanCloud ID和KEY")})}}},mounted:function(){n("b138");"undefined"!==typeof window&&(this.window=window,window.AV=n("0631"))}},c=d,f=(n("0f52"),n("2877")),p=Object(f["a"])(c,o,s,!1,null,null,null);p.options.__file="Transfer.vue";var m=p.exports,h={name:"app",components:{Transfer:m}},v=h,b=(n("034f"),Object(f["a"])(v,a,i,!1,null,null,null));b.options.__file="App.vue";var y=b.exports,_=n("5c96"),g=n.n(_);n("0fae");r["default"].config.productionTip=!1,r["default"].use(g.a),new r["default"]({render:function(t){return t(y)}}).$mount("#app")},"64a9":function(t,e,n){}});
//# sourceMappingURL=app.7a010157.js.map